<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link href="assets/bootstrap.min.css" rel="stylesheet">
    <style>
        nav {
            margin: 0px;
        }
        #response-container {
            display: none;
            padding: 1rem;
            margin: 3rem 5%;
            font-size: 120%;
            border: 5px dashed #ccc;
            word-wrap: break-word;
        }
        label {
            margin-left: 0.3rem;
            margin-right: 0.3rem;
        }
        button {
            font-size: 100%;
            padding: 0.5rem;
            margin: 0.3rem;
            text-transform: uppercase;
        }
        .nav-link {
            color:white!important;
        }
        tr, td {
            border: 1px solid black;
        }


        /* Define widths for the table columns */
        #data-table td:nth-child(1) {
            width: 20%;
        }

        #data-table td:nth-child(2),
        #data-table td:nth-child(3) {
            width: 40%;
        }

.droptarget {
  height: 200px;
  padding: 5px;
  border: 1px solid black;
}

    </style>
</head>
<body style="padding: 5px;">
    <nav class="navbar navbar-expand-lg navbar-light fixed-top text-white" id="navBar" style="background: #50B498;"> 
    </nav>
    <br>
    <br>

    <div class="row mt-1" style="height: 500px;">
        <div class="col-4 bg-white" >
            <div style="width: 100%; margin: auto; padding: 15px;color: #4e4e4e;">
                <h3>Search Appliance:</h3>
                <input type="text" id="searchByName" class="form-control mb-2">
                <hr>
                <h1>Upload and Display Image</h1>
                 Appliance Name:
                <input type="text" id="appliance" class="form-control mb-2">
                 Image:
                <img id="imagePreview" src="" alt="Image will be displayed here" style="max-width: 90px; height: auto;">
                <input type="file" id="fileInput" accept="image/*" class="form-control mb-2">
                <div class="d-grid">
                    <input type="submit" class="btn btn-primary btn-block" id="uploadButton" value="Upload">
                </div>
                <br><br>
            </div>
        </div>
        <div class="col-8 bg-light p-3" style="height: 100%; overflow-y: auto;">
            <table id="data-table" class="table table-fluid" border="1" style="margin: auto;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Firstname</th>
                        <th>Lastname</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                </tbody>
            </table>
        </div>  
        
    </div>




<div class="droptarget" id="applianceList">
  <!-- <p draggable="true" id="dragtarget">Drag me!</p> -->
</div>

<div class="droptarget"></div>

<p>Drag the text up and down between the two rectangles.</p>

<p id="demo"></p>


<script>


        function showNavbar() {
            pywebview.api.navbar().then(getNavbar);
        }


        function getNavbar(response) {
            const a = document.getElementById('navBar');
            a.innerHTML = response.message;
        }



        function showAppliance() {
            pywebview.api.appliance_list().then(outputApplianceList);
        }


        function outputApplianceList(response) {
            const a = document.getElementById('applianceList');
            a.innerHTML = response.message;
        }


        // Listener event for search
        const s = document.getElementById('searchByName');
        s.addEventListener("keyup", searchInputBlank);

        function searchInputBlank() {
            const search = document.getElementById('searchByName').value;
            if (search === '') {
                // Call show all data if search is empty
                showData();
            } else {
                searchByName();
            }
        }

        // Fetch and display all data
        function showData() {
            pywebview.api.fetch_appliance().then(showResponse);
        }

        // Search by name
        function searchByName() {
            const name = document.getElementById('searchByName').value;
            pywebview.api.search_data(name).then(showResponse);
        }

        // Display response in an HTML table
        function showResponse(response) {

            const tbody = document.getElementById('table-body');
            tbody.innerHTML = response.message;

            // Check if response has any data
        }

        window.addEventListener('pywebviewready', function() {
            showNavbar();
            showData();
            showAppliance();
        });

</script>

<script>

let draggedElement = null;

// Handle drag start event
document.addEventListener("dragstart", function(event) {
  // Store the dragged element reference
  draggedElement = event.target;

  // Set the dragged data (we can use the element's ID or a reference)
  event.dataTransfer.setData("Text", event.target.id);

  // Output some text when starting to drag the element
  document.getElementById("demo").innerHTML = "Started to drag the element.";
  
  // Change the opacity of the draggable element
  event.target.style.opacity = "0.4";
});

// Change output text color while dragging
document.addEventListener("drag", function(event) {
  document.getElementById("demo").style.color = "red";
});

// Reset opacity and output text when drag ends
document.addEventListener("dragend", function(event) {
  document.getElementById("demo").innerHTML = "Finished dragging the element.";
  event.target.style.opacity = "1";
});

// Handle drag enter event (change border of the drop target)
document.addEventListener("dragenter", function(event) {
  if (event.target.className == "droptarget") {
    event.target.style.border = "3px dotted red";
  }
});

// Allow drop event by preventing the default action
document.addEventListener("dragover", function(event) {
  event.preventDefault();
});

// Handle drag leave event (reset border of the drop target)
document.addEventListener("dragleave", function(event) {
  if (event.target.className == "droptarget") {
    event.target.style.border = "";
  }
});

// Handle drop event
document.addEventListener("drop", function(event) {
  event.preventDefault();
  
  // Only proceed if the drop target has the class 'droptarget'
  if (event.target.className == "droptarget") {
    document.getElementById("demo").style.color = "";
    event.target.style.border = "";

    // Remove the dragged element from its original container (if it has a parent)
    if (draggedElement && draggedElement.parentNode) {
      draggedElement.parentNode.removeChild(draggedElement);
    }

    // Append the dragged element (or a new image) to the drop target
    event.target.appendChild(draggedElement);
  }
});


document.addEventListener("drop", function(event) {
  event.preventDefault();
  if ( event.target.className == "droptarget" ) {
    document.getElementById("demo").style.color = "";
    event.target.style.border = "";
    var data = event.dataTransfer.getData("Text");
    event.target.appendChild(document.getElementById(data));

  }
});
</script>
<script>
    //upload image
    document.getElementById('uploadButton').addEventListener('click', async function (event) {
        var file = document.getElementById('fileInput').files[0];
        var appliance = document.getElementById('appliance').value;
        var reader = new FileReader();
        reader.onload = function (e) {
            var base64Image = e.target.result.split(',')[1];
            window.pywebview.api.upload_image(base64Image, appliance).then(function (response) {
                document.getElementById('image').src = response;
            });
        };
        reader.readAsDataURL(file);

        document.getElementById('fileInput').value = '';
        document.getElementById('appliance').value = ''; 
        document.getElementById('imagePreview').style.display = 'none'; 

        setTimeout(() => {
            showData();
            Swal.fire({
              position: "top-end",
              icon: "success",
              title: "Saved successfully",
              showConfirmButton: false,
              timer: 1500
            });
        }, 2000);
    });
    </script>
    <script>
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('fileInput').addEventListener('change', function(event) {
        var file = document.getElementById('fileInput').files[0];  // Get selected file
        var appliance = document.getElementById('appliance').value;  // Get appliance name
        
        if (file) {
            var reader = new FileReader();
            
            // Once the file is read as Data URL (base64), display the preview
            reader.onload = function(e) {
                var preview = document.getElementById('imagePreview');
                preview.src = e.target.result;  // Set the base64 data as the image source
                preview.style.display = 'block';  // Show the image preview
            };
            
            reader.readAsDataURL(file);  // Read the file as base64 Data URL
        }
    });
    </script>
    <script src="assets/bootstrap.min.js"></script>
    <script src="assets/sweetalert.js"></script>
</body>
</html>
